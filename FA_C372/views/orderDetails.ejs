<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduSphere | Order Details</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/styles/style.css" />
  </head>
  <body class="course-page">
    <%- include("partials/navbar") %>
    <main class="section">
      <div class="container">
        <% if (status?.ordered) { %>
          <div class="alert alert-success">Order placed successfully.</div>
        <% } %>
        <div class="course-hero mb-4">
          <div>
            <p class="eyebrow text-uppercase text-muted mb-2">Invoice</p>
            <h1 class="display-6 fw-bold mb-1">Order #<%= order.id %></h1>
            <p class="text-muted mb-0">
              <%= order.created_at ? new Date(order.created_at).toLocaleString() : "" %>
            </p>
          </div>
          <div class="course-hero-card">
            <p class="text-muted small mb-1">Total</p>
            <strong class="display-6">$<%= Number(order.total_amount || 0).toFixed(2) %></strong>
            <p class="text-muted small mb-0 text-capitalize">
              <%= order.payment_status %> Â· <%= order.order_status %>
            </p>
          </div>
        </div>

        <div class="dashboard-panel">
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>Course</th>
                  <th>Qty</th>
                  <th>Unit Price</th>
                  <th>Line Total</th>
                </tr>
              </thead>
              <tbody>
                <% (order.items || []).forEach(function(item) { %>
                  <tr>
                    <td><%= item.course_name %></td>
                    <td><%= item.quantity %></td>
                    <td>$<%= Number(item.unit_price || 0).toFixed(2) %></td>
                    <td>$<%= (Number(item.unit_price || 0) * Number(item.quantity || 1)).toFixed(2) %></td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <% if (status?.invoice_error === "pdf_unavailable") { %>
            <div class="alert alert-warning mt-3">Invoice PDF is temporarily unavailable.</div>
          <% } %>
          <div class="mt-3">
            <a class="btn btn-outline-primary btn-sm" href="/orders">Back to purchase history</a>
            <a class="btn btn-outline-secondary btn-sm" href="/orders/<%= order.id %>?download=invoice">Download invoice PDF</a>
            <button class="btn btn-outline-dark btn-sm" type="button" onclick="window.print()">Print invoice</button>
            <a class="btn btn-outline-secondary btn-sm" href="/courses">Browse more courses</a>
            <a class="btn btn-primary btn-sm" href="/dashboard/student">Go to dashboard</a>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
