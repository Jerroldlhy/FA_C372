<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduSphere | Log In</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@300..800&family=Space+Grotesk:wght@400..700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles/style.css" />
  </head>
  <body class="auth-page">
    <main class="auth-wrapper">
      <a class="back-link" href="/">&larr; Back to Home</a>
      <section class="auth-card">
        <div class="auth-brand">
          <span class="brand-mark"></span>
          <span>EduSphere</span>
        </div>
        <h1>Welcome Back</h1>
        <p class="auth-subtitle">Sign in to access your personalized dashboard.</p>

        <% if (error) { %>
          <div class="auth-alert auth-alert-danger"><%= error %></div>
        <% } %>
        <% if (info?.sent_verify) { %>
          <div class="auth-alert auth-alert-info">
            Verification email sent. Please check your inbox.
          </div>
        <% } %>
        <% if (info?.verified) { %>
          <div class="auth-alert auth-alert-success">
            Email verified! You can now log in.
          </div>
        <% } %>
        <% if (info?.verify_error === "missing") { %>
          <div class="auth-alert auth-alert-warning">
            Verification token missing from the link.
          </div>
        <% } %>
        <% if (info?.verify_error === "invalid") { %>
          <div class="auth-alert auth-alert-danger">
            Invalid verification token.
          </div>
        <% } %>
        <% if (info?.pending_verification) { %>
          <div class="auth-alert auth-alert-warning">
            Please verify your email before logging in.
          </div>
        <% } %>
        <% if (info?.resent) { %>
          <div class="auth-alert auth-alert-info">
            Verification email resent—check your inbox.
          </div>
        <% } %>
        <% if (info?.resend_error === "missing") { %>
          <div class="auth-alert auth-alert-danger">
            Enter an email address to resend the link.
          </div>
        <% } %>
        <% if (info?.resend_error === "not_found") { %>
          <div class="auth-alert auth-alert-danger">
            We couldn't find that email.
          </div>
        <% } %>
        <% if (info?.resend === "already_verified") { %>
          <div class="auth-alert auth-alert-success">
            Email already verified—just log in.
          </div>
        <% } %>
        <% if (info?.social_unavailable) { %>
          <div class="auth-alert auth-alert-info">
            Social login is not wired up yet. Use your email/password instead.
          </div>
        <% } %>
        <% if (info?.password_reset) { %>
          <div class="auth-alert auth-alert-success">
            Password reset successful. You can now log in.
          </div>
        <% } %>
        <% if (info?.twofa_error === "not_enabled") { %>
          <div class="auth-alert auth-alert-warning">
            Two-factor authentication is not enabled for this account.
          </div>
        <% } %>

        <form method="POST" action="/login" class="auth-form">
          <label>
            Email Address
            <input
              type="email"
              name="email"
              placeholder="you@example.com"
              required
            />
          </label>
          <label>
            Password
            <div class="password-field">
              <input
                type="password"
                id="login-password"
                name="password"
                placeholder="Enter your password"
                minlength="6"
                required
              />
              <button
                type="button"
                class="eye-toggle"
                data-password-toggle="login-password"
                aria-label="Show password"
              >
                <span class="eye-icon"></span>
              </button>
            </div>
          </label>
          <div class="auth-form-links">
            <a href="/forgot-password">Forgot password?</a>
          </div>
          <button type="submit" class="btn btn-primary auth-submit">
            Log In
          </button>
        </form>

        <div class="auth-divider">
          <span>Or sign in with</span>
        </div>
        <a class="btn btn-outline auth-social" href="/auth/google">
          <span class="google-icon">G</span> Google
        </a>

        <p class="text-muted small text-center mt-3">
          Didn’t see the verification email?
        </p>
        <form method="POST" action="/resend-verification" class="resend-form">
          <input
            type="email"
            name="email"
            placeholder="Email for verification"
            autocomplete="email"
            required
            class="form-control form-control-sm"
          />
          <button type="submit" class="btn btn-outline w-100">
            Resend verification email
          </button>
        </form>

        <p class="auth-footer">
          Don’t have an account? <a href="/signup">Sign up</a>
        </p>
      </section>
    </main>
    <script src="/scripts/main.js"></script>
  </body>
</html>
